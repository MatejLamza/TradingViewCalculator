// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © meowcake24

//@version=5
indicator("TCL Calculator Limit 1 Updated",overlay = true)

accountSize = input.int(1000, 'Account Size', group='Settings')
riskPercentage = input.int(50, 'Risk', group='Settings')
leverage = input.int(50, 'Leverage', group='Settings')
manage = input.int(3, 'Manage', group='Settings')

// Define user input for Orders
entry = input.float(0, 'Entry', group='Orders')
limit1 = input.float(0, 'Limit 1', group='Orders')
takeProfit = input.float(0, 'Take Profit', group='Orders')
stopLoss = input.float(0, 'Stop Loss', group='Orders')

plot(entry, title='Entry', color=color.new(color.blue, 0), linewidth=2, offset=65)
plot(limit1, title='Limit 1', color=color.new(color.purple, 0), linewidth=2, offset=65)
plot(takeProfit, title='Take Profit', color=color.new(color.green, 0), linewidth=2, offset=65)
plot(stopLoss, title='Stop Loss', color=color.new(color.red, 0), linewidth=2, offset=65)

isLong = entry > takeProfit ? false : true
cellName = isLong ? 'Long' : 'Short'
accountLoss = (riskPercentage/100) * accountSize
avgCost = (entry + (limit1 * 2)) / 3

winFactor = entry - takeProfit
temp = accountLoss / (avgCost-stopLoss)
takeProfitPercentage = math.abs((winFactor / entry)*100)
entryQty = (temp/3)
entryTPAmount = isLong ? (takeProfit*entryQty) - (entry* entryQty) : (entry*entryQty) - (takeProfit * entryQty)
entryTPPercentage = entryTPAmount / accountSize

var tclTable = table.new(position=position.bottom_right, columns=7, rows=7,border_width = 5,frame_width = 3,frame_color = color.gray)

table.merge_cells(table_id = tclTable,start_column = 1,end_column = 2,start_row = 1,end_row = 1)
table.cell(table_id=tclTable, column=1, row=1, text= "Account Size", text_color=color.white, bgcolor=color.black)

table.merge_cells(table_id = tclTable,start_column = 3,end_column = 4,start_row = 1,end_row = 1)
table.cell(table_id=tclTable, column=3, row=1, text = "$ " +  str.tostring(accountSize) + "", text_color=color.white, bgcolor=color.black)
table.cell(table_id=tclTable, column=5, row=1, text = "Leverage", text_color=color.white, bgcolor=color.black)
table.cell(table_id=tclTable, column=6, row=1, text = "Margin", text_color=color.white, bgcolor=color.black)

table.merge_cells(table_id = tclTable,start_column = 1,end_column = 2,start_row = 2,end_row = 2)
table.cell(table_id=tclTable, column=1, row=2, text = str.substring(syminfo.ticker,0,5) + " \n" + cellName, text_color=color.white, bgcolor=color.black)
table.merge_cells(table_id = tclTable,start_column = 3,end_column = 4,start_row = 2,end_row = 2)
table.cell(table_id=tclTable, column=3, row=2, text = "QTY", text_color=color.white, bgcolor=color.black)
table.cell(table_id=tclTable, column=5, row=2, text = str.tostring(leverage) + "X", text_color=color.white, bgcolor=color.black)
table.cell(table_id=tclTable, column=6, row=2, text = "74.24%", text_color=color.white, bgcolor=color.black)

table.cell(table_id=tclTable, column=1, row=3, text = "Entry", text_color=color.white, bgcolor=color.black)
table.cell(table_id=tclTable, column=2, row=3, text = str.tostring(entry), text_color=color.white, bgcolor=color.black)

table.merge_cells(table_id = tclTable,start_column = 3,end_column = 4,start_row = 3,end_row = 4)
table.cell(table_id=tclTable, column=3, row=3, text = str.tostring(math.round((entryQty/3),2)), text_color=color.white, bgcolor=color.black)

table.merge_cells(table_id = tclTable,start_column = 5,end_column = 6,start_row = 3,end_row = 3)
table.cell(table_id=tclTable, column=5, row=3, text = "Risk", text_color=color.white, bgcolor=color.black)

table.cell(table_id=tclTable, column=1, row=4, text = "TP", text_color=color.white, bgcolor=color.black)
table.cell(table_id=tclTable, column=2, row=4, text = str.tostring(takeProfit), text_color=color.white, bgcolor=color.black)

table.cell(table_id=tclTable, column=5, row=4, text = str.tostring(riskPercentage) + "%", text_color=color.white, bgcolor=color.black)
table.cell(table_id=tclTable, column=6, row=4, text = str.tostring(accountLoss) + " $", text_color=color.white, bgcolor=color.black)

table.cell(table_id=tclTable, column=1, row=5, text = "SL", text_color=color.white, bgcolor=color.black)
table.cell(table_id=tclTable, column=2, row=5, text = str.tostring(stopLoss), text_color=color.white, bgcolor=color.black)

table.merge_cells(table_id = tclTable,start_column = 3,end_column = 4,start_row = 5,end_row = 5)
table.cell(table_id=tclTable, column=3, row=5, text = str.tostring(math.round(takeProfitPercentage,2)) + " %", text_color=color.white, bgcolor=color.black)

table.merge_cells(table_id = tclTable,start_column = 5,end_column = 6,start_row = 5,end_row = 5)
table.cell(table_id=tclTable, column=5, row=5, text = "Entry TP Amount", text_color=color.white, bgcolor=color.black)

table.cell(table_id=tclTable, column=5, row=6, text = str.tostring(math.round(entryTPAmount,2)) + " $", text_color=color.white, bgcolor=color.black)
table.cell(table_id=tclTable, column=6, row=6, text = str.tostring(math.round((entryTPPercentage*100),2)) + " %", text_color=color.white, bgcolor=color.black)
